
/* This file was automatically generated by pclu.*/

#include "pclu_err.h"
#include "pclu_sys.h"


extern errcode file_nameOPget_dir();
extern errcode file_nameOPget_suffix();
extern errcode stringOPempty();
extern errcode working_dir();
extern errcode boolOPnot();
extern errcode charOPequal();
extern errcode stringOPfetch();
extern errcode stringOPindexc();
extern errcode intOPequal();
extern errcode intOPadd();
extern errcode stringOPsize();
extern errcode stringOPconcat();
extern errcode _home_dir();
extern errcode stringOPsubstr();
extern errcode intOPsub();
extern errcode stringOPrest();
extern errcode stringOPequal();
extern errcode file_nameOPcreate();
extern errcode file_nameOPget_name();
extern errcode file_nameOPget_other();

/**** BEGIN PROCEDURE file_name_fill ****/

errcode file_name_fill(fn, dsuffix, ret_1)
CLUREF fn;
CLUREF dsuffix;
CLUREF *ret_1;
    {
    errcode err;
    errcode ecode2;
    CLUREF dir;
    CLUREF suffix;
    CLUREF change;
    CLUREF z;
    enter_proc(3);

  LINE(5);
    {
        {CLUREF T_1_1;
        err = file_nameOPget_dir(fn, &T_1_1);
        if (err != ERR_ok) goto ex_0;
        dir.num = T_1_1.num;
        }
        }

  LINE(6);
    {
        {CLUREF T_1_1;
        err = file_nameOPget_suffix(fn, &T_1_1);
        if (err != ERR_ok) goto ex_0;
        suffix.num = T_1_1.num;
        }
        }

  LINE(7);
    {
        {change.tf = false;
        }
        }

  LINE(8);
    {
    CLUREF T_1_1;
    err = stringOPempty(dir, &T_1_1);
    if (err != ERR_ok) goto ex_0;
    if (T_1_1.num == true) {

  LINE(9);
        {
        CLUREF T_2_1;
        err = working_dir(&T_2_1);
        if (err != ERR_ok) goto ex_0;
        dir.num = T_2_1.num;
        }

  LINE(10);
        {
        CLUREF T_2_1;
        CLUREF T_2_2;
        err = stringOPempty(dir, &T_2_1);
        if (err != ERR_ok) goto ex_0;
        T_2_2.num = T_2_1.num ^ 1;
        change.num = T_2_2.num;
        }
        }
    else {
    CLUREF T_1_2;
    CLUREF T_1_3;
    CLUREF T_1_4;
    err = stringOPfetch(dir, CLU_1, &T_1_2);
    if (err != ERR_ok) goto ex_0;
    T_1_3.ch = '~';
    T_1_4.num = (T_1_2.ch == T_1_3.ch)? true : false;
    if (T_1_4.num == true) {

  LINE(12);
        {
            {CLUREF T_2_1;
            CLUREF T_2_2;
            T_2_1.ch = '/';
            err = stringOPindexc(T_2_1, dir, &T_2_2);
            if (err != ERR_ok) goto ex_0;
            z.num = T_2_2.num;
            }
            }

  LINE(13);
        {
        CLUREF T_2_1;
        T_2_1.num = (z.num == 0)? true : false;
        if (T_2_1.num == true) {

  LINE(14);
            {
            CLUREF T_3_1;
            CLUREF T_3_2;
            err = stringOPsize(dir, &T_3_1);
            if (err != ERR_ok) goto ex_0;
            T_3_2.num = T_3_1.num + 1;
             if ((T_3_2.num > 0 && T_3_1.num < 0 && 1 < 0) || 
                 (T_3_2.num < 0 && T_3_1.num > 0 && 1 > 0)) {
                err = ERR_overflow;
                goto ex_0;}
            z.num = T_3_2.num;
            }
            }
            }/* end if */

  LINE(15);
        {
        CLUREF T_3_1;
        CLUREF T_3_2;
        CLUREF T_3_3;
        CLUREF T_3_4;
        CLUREF T_3_5;
        T_3_1.num = z.num - 2;
         if ((T_3_1.num >= 0 && z.num < 0 && (-2) < 0) || 
             (T_3_1.num <= 0 && z.num > 0 && (-2) > 0)) {
            err = ERR_overflow;
            goto ex_1;}
        err = stringOPsubstr(dir, CLU_2, T_3_1, &T_3_2);
        if (err != ERR_ok) goto ex_1;
        err = _home_dir(T_3_2, &T_3_3);
        if (err != ERR_ok) goto ex_1;
        err = stringOPrest(dir, z, &T_3_4);
        if (err != ERR_ok) goto ex_1;
        err = stringOPconcat(T_3_3, T_3_4, &T_3_5);
        if (err != ERR_ok) goto ex_1;
        dir.num = T_3_5.num;
        }
            goto end_1;
            ex_1:
                if ((err == ERR_not_found)) {
                }
                else {
                    goto ex_0;
                }
            end_1:;

  LINE(18);
        {
        CLUREF T_2_1;
        CLUREF T_2_2;
        CLUREF T_2_3;
        err = file_nameOPget_dir(fn, &T_2_1);
        if (err != ERR_ok) goto ex_0;
        T_2_2.num = ((dir.str->size != T_2_1.str->size)? false :
            !(bcmp(dir.str->data, T_2_1.str->data, dir.str->size)));
        T_2_3.num = T_2_2.num ^ 1;
        change.num = T_2_3.num;
        }
        }
    else {
    CLUREF T_1_5;
    CLUREF T_1_6;
    CLUREF T_1_7;
    CLUREF T_1_8;
    err = stringOPfetch(dir, CLU_1, &T_1_5);
    if (err != ERR_ok) goto ex_0;
    T_1_6.ch = '/';
    T_1_7.num = (T_1_5.ch == T_1_6.ch)? true : false;
    T_1_8.num = T_1_7.num ^ 1;
    if (T_1_8.num == true) {

  LINE(20);
        {
        CLUREF T_2_1;
        CLUREF T_2_2;
        err = working_dir(&T_2_1);
        if (err != ERR_ok) goto ex_0;
        err = stringOPconcat(T_2_1, dir, &T_2_2);
        if (err != ERR_ok) goto ex_0;
        dir.num = T_2_2.num;
        }

  LINE(21);
        {
        CLUREF T_2_1;
        CLUREF T_2_2;
        CLUREF T_2_3;
        err = file_nameOPget_dir(fn, &T_2_1);
        if (err != ERR_ok) goto ex_0;
        T_2_2.num = ((dir.str->size != T_2_1.str->size)? false :
            !(bcmp(dir.str->data, T_2_1.str->data, dir.str->size)));
        T_2_3.num = T_2_2.num ^ 1;
        change.num = T_2_3.num;
        }
        }
        }}}/* end if */

  LINE(23);
    {
    CLUREF T_1_1;
    CLUREF T_1_2;
    CLUREF T_1_3;
    CLUREF T_1_4;
    err = stringOPempty(suffix, &T_1_2);
    if (err != ERR_ok) goto ex_0;
    T_1_1.num = T_1_2.num;
    if (T_1_2.num) {
        err = stringOPempty(dsuffix, &T_1_3);
        if (err != ERR_ok) goto ex_0;
        T_1_4.num = T_1_3.num ^ 1;
        T_1_1.num = T_1_4.num;
    }
    if (T_1_1.num == true) {

  LINE(24);
        {
        suffix.num = dsuffix.num;
        }

  LINE(25);
        {
        change.tf = true;
        }
        }
        }/* end if */

  LINE(27);
    {
    if (change.num == true) {

  LINE(28);
        {
        CLUREF T_3_1;
        CLUREF T_3_2;
        CLUREF T_3_3;
        err = file_nameOPget_name(fn, &T_3_1);
        if (err != ERR_ok) goto ex_2;
        err = file_nameOPget_other(fn, &T_3_2);
        if (err != ERR_ok) goto ex_2;
        err = file_nameOPcreate(dir, T_3_1, suffix, T_3_2, &T_3_3);
        if (err != ERR_ok) goto ex_2;
        fn.num = T_3_3.num;
        }
            goto end_2;
            ex_2:
                if ((err == ERR_bad_format)) {
                }
                else {
                    goto ex_0;
                }
            end_2:;
        }
        }/* end if */

  LINE(31);
    {
    {
    ret_1->num = fn.num;
    }
    {signal (ERR_ok);}}
    goto end_0;
    ex_0:
        {
            if (err == ERR_failure) {signal(ERR_failure);}
            elist[0] = _pclu_erstr(err);
            {signal(ERR_failure);}
        }
    end_0: elist[0].str = no_return_values_STRING;
        {signal(ERR_failure);}
    }

/**** END PROCEDURE file_name_fill ****/

